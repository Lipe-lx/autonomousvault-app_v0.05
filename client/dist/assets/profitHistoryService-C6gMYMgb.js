import{S as i}from"./index-BINFzqBP.js";const r="hl_dealer_profit_history",o=1e3,c=6e4;class l{constructor(){this.cache=null,this.lastValue=null,this.lastTimestamp=0}async recordSnapshot(t){const e=t.timestamp-this.lastTimestamp,a=this.lastValue!==null&&Math.abs(t.portfolioValue-this.lastValue)<.01;if(t.trigger==="sync"&&a&&e<c)return;const s=await this.loadHistory();s.push(t),s.length>o&&s.splice(0,s.length-o),await this.saveHistory(s),this.cache=s,this.lastValue=t.portfolioValue,this.lastTimestamp=t.timestamp,console.log(`[ProfitHistory] ðŸ“Š Recorded snapshot: $${t.portfolioValue.toFixed(2)} (${t.trigger})`)}async getHistory(t){const e=await this.loadHistory();return t?e.filter(a=>a.timestamp>=t):e}async clearHistory(){await i.removeItem(i.getUserKey(r)),this.cache=null,this.lastValue=null,this.lastTimestamp=0,console.log("[ProfitHistory] ðŸ—‘ï¸ History cleared")}async loadHistory(){if(this.cache!==null)return this.cache;try{const t=await i.getItem(i.getUserKey(r));if(t){if(this.cache=JSON.parse(t),this.cache&&this.cache.length>0){const e=this.cache[this.cache.length-1];this.lastValue=e.portfolioValue,this.lastTimestamp=e.timestamp}return this.cache}}catch(t){console.warn("[ProfitHistory] Failed to load history:",t)}return this.cache=[],this.cache}async saveHistory(t){try{await i.setItem(i.getUserKey(r),JSON.stringify(t))}catch(e){console.error("[ProfitHistory] Failed to save history:",e)}}}const y=new l;export{y as profitHistoryService};
